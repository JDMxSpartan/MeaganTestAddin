function onMessageSendHandler(e){Promise.all([getToRecipientsAsync(),getSenderAsync(),getBodyAsync(),getCCAsync(),getBCCAsync()]).then((([n,t,o,s,i])=>{console.log("To recipients:"),n.forEach((e=>console.log(e.emailAddress))),console.log("Sender:"+t.displayName+" "+t.emailAddress),console.log("CC: "+s.emailAddress),console.log("BCC: "+i.emailAddress),console.log("Body:"+o);const c=getBannerFromBody(o);bannerNullHandler(c,e);const a=parseBannerMarkings(c);""!==a.message&&errorPopupHandler(a.message,e)}))}function getBannerFromBody(e){const n=e.match(/^(TOP *SECRET|TS|SECRET|S|CONFIDENTIAL|C|UNCLASSIFIED|U)((\/\/)?(.*)?(\/\/)((.*)*))?/im);return console.log(n),n?(console.log("banner found"),n[0]):(console.log("banner null"),null)}function bannerNullHandler(e,n){null!=e||n.completed({allowEvent:!1,cancelLabel:"Ok",commandId:"msgComposeOpenPaneButton",contextData:JSON.stringify({a:"aValue",b:"bValue"}),errorMessage:"Please enter a banner, banner error detected.",sendModeOverride:Office.MailboxEnums.SendModeOverride.PromptUser})}function hasMatches(e){if(null==e||""==e)return!1;const n=["send","picture","document","attachment"];for(let t=0;t<n.length;t++){const o=n[t].trim();if(RegExp(o,"i").test(e))return!0}return!1}function getAttachmentsCallback(e){const n=e.asyncContext;if(e.value.length>0){for(let t=0;t<e.value.length;t++)if(0==e.value[t].isInline)return void n.completed({allowEvent:!0});n.completed({allowEvent:!1,errorMessage:"Looks like the body of your message includes an image or an inline file. Would you like to attach a copy of it to the message?",cancelLabel:"Attach a copy",commandId:"msgComposeOpenPaneButton",sendModeOverride:Office.MailboxEnums.SendModeOverride.PromptUser})}else n.completed({allowEvent:!1,errorMessage:"Looks like you're forgetting to include an attachment blayh blah testing.",cancelLabel:"Add an attachment",commandId:"msgComposeOpenPaneButton"})}function getToRecipientsAsync(){return new Promise(((e,n)=>{Office.context.mailbox.item.to.getAsync((t=>{t.status!==Office.AsyncResultStatus.Succeeded?(console.error("Failed to get 'To' recipients. Error: "+JSON.stringify(t.error)),n("Failed to get 'To' recipients.")):e(t.value)}))}))}function getSenderAsync(){return new Promise(((e,n)=>{Office.context.mailbox.item.from.getAsync((t=>{t.status!==Office.AsyncResultStatus.Succeeded?(console.log("unable to get sender"),n("Failed to get sender. "+JSON.stringify(t.error))):e(t.value)}))}))}function getBodyAsync(){return new Promise(((e,n)=>{Office.context.mailbox.item.body.getAsync(Office.CoercionType.Text,(t=>{t.status!==Office.AsyncResultStatus.Succeeded?(console.log("unable to get body"),n("Failed to get body. "+JSON.stringify(t.error))):e(t.value)}))}))}function getCCAsync(){return new Promise(((e,n)=>{Office.context.mailbox.item.cc.getAsync((t=>{t.status!==Office.AsyncResultStatus.Succeeded?(console.error("Failed to get 'CC' recipients. Error: "+JSON.stringify(t.error)),n("Failed to get 'CC' recipients.")):e(t.value)}))}))}function getBCCAsync(){return new Promise(((e,n)=>{Office.context.mailbox.item.bcc.getAsync((t=>{t.status!==Office.AsyncResultStatus.Succeeded?(console.error("Failed to get 'BCC' recipients. Error: "+JSON.stringify(t.error)),n("Failed to get 'BCC' recipients.")):e(t.value)}))}))}function parseBannerMarkings(e){const n=/ORIGINATOR\s*CONTROLLED|ORCON|NOT\s*RELEASABLE\s*TO\s*FOREIGN\s*NATIONALS|NOFORN|AUTHORIZED\s*FOR\s*RELEASE\s*TO\s*((USA|AUS|NZL)(,)?( *))*|REL\s*TO\s*((USA|AUS|NZL)(,)?( *))*|CAUTION-PROPERIETARY\s*INFORMATION\s*INVOLVED|PROPIN/gi,t=e.split("//");console.log(t);let o=Category(t[0],/TOP\s*SECRET|TS|SECRET|S|CONFIDENTIAL|C|UNCLASSIFIED|U/gi,1),s=null,i=null;return t[1]?t[1].toUpperCase().match(n)?(console.log("second category matches category 7"),s=null,i=Category(t[1],n,7)):(console.log("second category doesnt match category 7, running normal program"),s=Category(t[1],/COMINT|-GAMMA|\/|TALENT\s*KEYHOLE|SI-G\/TK|HCS|GCS/gi,4),i=Category(t[2],n,7)):console.log("second category returned null"),{banner:[o,s,i],message:checkDisseminations(o,i)}}function getSubMarkings(e){let n=e.split("/");return n.length<=1?(console.log("There is only one submarking"),null):(console.log(n),n)}function Category(e,n,t){return e?e.toUpperCase().match(n)?(console.log("returning category "+t),console.log(e.toUpperCase()),e.toUpperCase()):(console.log("String did not match category "+t+"'s regex"),null):(console.log("Category "+t+" string returned null"),null)}function ValidateClassification(e){return regex=/TS|S|C|U/gi,!!e.match(regex)}function validateSCI(e,n,t){let o=0,s="";return n.split("/").ForEach((i=>{i.match(/HCS/gi)&&((e.includes("U")||e.includes("UNCLASSIFIED"))&&(o=1,s+="CANNOT USE HCS with UNCLASSIFIED. "),t.includes("NOFORN")||t.includes("NOT RELEASABLE TO FOREIGN NATIONALS")||(o=1,s+="HCS MUST USE NOFORN. ")),i.match(/SI/gi)&&(e.includes("U")||e.includes("UNCLASSIFIED"))&&(o=1,s+="CANNOT USE SI with UNCLASSIFIED. "),i.match(/-G/gi)&&(e.includes("TS")&&e.includes("TOP SECRET")||(o=1,s+="CANNOT USE -G with UNCLASSIFIED, CONFIDENTIAL, or SECRET. "),n.includes("SI")&&n.includes("COMINT")||(o=1,s+="MUST USE -G with SI. "),n.includes("ORCON")&&n.includes("ORIGINATOR CONTROLLED")||(o=1,s+="MUST USE -G with ORCON. ")),i.match(/-ECI/gi)&&(e.includes("TS")&&e.includes("TOP SECRET")||(o=1,s+="CANNOT USE -ECI with UNCLASSIFIED, CONFIDENTIAL, or SECRET. "),n.includes("SI")&&n.includes("COMINT")||(o=1,s+="MUST USE -ECI with SI. ")),i.match(/TK/gi)&&(e.includes("TS")&&e.includes("TOP SECRET")&&e.includes("S")&&e.includes("SECRET")||(o=1,s+="CANNOT USE TK with UNCLASSIFIED, CONFIDENTIAL. "))})),[o,s]}function checkDisseminations(e,n){console.log("CLASSIFICATION: "+e+"\n"),console.log("DISSEM: "+n+"\n");let t="",o=n.split("/"),s=[];for(let e=0;e<o.length;e++)s.push(o[e]);let i=!1,c=!1,a=!1,r=!1;for(let n=0;n<s.length;n++)"FOUO"===s[n]&&"UNCLASSIFIED"!==e&&(t="Cannot use FOUO with classified information."),"ORCON"===s[n]&&"UNCLASSIFIED"===e&&(t="Cannot use ORCON with unclassified information."),"IMCON"===s[n]&&"SECRET"!==e&&(t="IMCON can only be used with SECRET information."),"SAMI"===s[n]&&"UNCLASSIFIED"===e&&(t="Cannot use SAMI with unclassified information."),"NOFORN"===s[n]?(i=!0,"UNCLASSIFIED"===e&&(t="Cannot use NOFORN with unclassified information.")):s[n].includes("EYES ONLY")?(s[n].match(/[A-Z]{3}\sEYES ONLY/g)?c=!0:t="Wrong formatting of EYES ONLY.","UNCLASSIFIED"===e&&(t="EYES ONLY cannot be used with unclassified information.")):"RELIDO"===s[n]?a=!0:s[n].includes("REL TO")&&(s[n].match(/REL TO\s[A-Z]{3}/g)?r=!0:t="Wrong formatting of REL TO.","UNCLASSIFIED"===e&&(t="Cannot use REL TO with unclassified information.")),i&&"EYES ONLY"===s[n]?t="NOFORN cannot be used with EYES ONLY.":c&&"NOFORN"===s[n]?t="EYES ONLY cannot be used with NOFORN.":i&&"RELIDO"===s[n]?t="NOFORN cannot be used with RELIDO.":a&&"NOFORN"===s[n]?t="RELIDO cannot be used with NOFORN.":i&&s[n].includes("REL TO")?t="NOFORN cannot be used with REL TO.":r&&"NOFORN"===s[n]?t="REL TO cannot be used with NOFORN.":c&&s[n].includes("REL TO")?t="EYES ONLY cannot be used with REL TO.":r&&"EYES ONLY"===s&&(t="REL TO cannot be used with EYES ONLY."),s[n].includes("RD")||s[n].includes("FRD")?"RD"===s[n]||"FRD"===s[n]?"UNCLASSIFIED"===e&&(t="Cannot use RD or FRD with unclassified information."):s[n].match(/(RD|FRD)-CNWDI/g)?"CONFIDENTIAL"!==e&&"UNCLASSIFIED"!==e||(t="-CNWDI cannot be used with CONFIDENTIAL or UNCLASSIFIED."):s[n].match(/(RD|FRD)-SG\[(?:[1-9]|[1-9][0-9]|99)\]/g)?"UNCLASSIFIED"===e&&(t="-SG cannot be used with UNCLASSIFIED information."):t="Wrong format of banner of RD and FRD.":s[n].includes("-CNWDI")?s[n].match(/(RD|FRD)-CNWDI/g)?"CONFIDENTIAL"!==e&&"UNCLASSIFIED"!==e||(t="-CNWDI cannot be used with CONFIDENTIAL or UNCLASSIFIED."):t="RD or FRD is required for -CNWDI.":s[n].includes("-SG")&&(s[n].match(/(RD|FRD)-SG\[(?:[1-9]|[1-9][0-9]|99)\]/g)?"UNCLASSIFIED"===e&&(t="-SG cannot be used with UNCLASSIFIED information."):t="RD or FRD is required for -SG[#]."),"DOD UCNI"!==s[n]&&"DOE UCNI"!==s[n]||"UNCLASSIFIED"!==e&&(t="DOD/DOE UCNI can only be used with unclassified information."),"DSEN"===s[n]&&"UNCLASSIFIED"!==e&&(t="DSEN can only be used with unclassified.");return t}function errorPopupHandler(e,n){n.completed({allowEvent:!1,cancelLabel:"Ok",commandId:"msgComposeOpenPaneButton",contextData:JSON.stringify({a:"aValue",b:"bValue"}),errorMessage:e})}Office.context.platform!==Office.PlatformType.PC&&null!=Office.context.platform||Office.actions.associate("onMessageSendHandler",onMessageSendHandler);